"use strict";(self.webpackChunkblog_postgraduate=self.webpackChunkblog_postgraduate||[]).push([[5904],{6262:(e,i)=>{i.A=(e,i)=>{const t=e.__vccOpts||e;for(const[e,n]of i)t[e]=n;return t}},7858:(e,i,t)=>{t.r(i),t.d(i,{comp:()=>g,data:()=>h});var n=t(641);const a=t.p+"assets/img/85cadf90dc96cf413afaf8668689ef0b.3e9fef39.png",A=t.p+"assets/img/image-20210303183633464.fe821e2b.png",p=t.p+"assets/img/image-20210303184026726.5982bf39.png",l=t.p+"assets/img/image-20210303184415482.5f9a747c.png",s=t.p+"assets/img/image-20210303191636900.ffb17d0e.png",r=t.p+"assets/img/image-20210304101549294.83f781d1.png",o=t.p+"assets/img/d7f12d4d480d7100cd9804d2b16b8a88.ddebb15e.png",d=t.p+"assets/img/image-20210303191137031.78b55dba.png",c={},g=(0,t(6262).A)(c,[["render",function(e,i){return(0,n.uX)(),(0,n.CE)("div",null,i[0]||(i[0]=[(0,n.Fv)('<h1 id="_07-自己动手-搭建-http-实验环境" tabindex="-1"><a class="header-anchor" href="#_07-自己动手-搭建-http-实验环境"><span>07 | 自己动手，搭建 HTTP 实验环境</span></a></h1><p>这一讲是「破冰篇」的最后一讲，我会先简单地回顾一下之前的内容，然后在 Windows 系统上实际操作，用几个应用软件搭建出一个「最小化」的 HTTP 实验环境，方便后续的基础篇、进阶篇、安全篇的学习。</p><h2 id="破冰篇回顾" tabindex="-1"><a class="header-anchor" href="#破冰篇回顾"><span>破冰篇回顾</span></a></h2><p>HTTP 协议诞生于 30 年前，设计之初的目的是用来传输纯文本数据。但由于形式灵活，搭配 URI、HTML 等技术能够把互联网上的资源都联系起来，构成一个复杂的超文本系统，让人们自由地获取信息，所以得到了迅猛发展。</p><p>HTTP 有多个版本，目前应用的最广泛的是 HTTP/1.1，它几乎可以说是整个互联网的基石。但 HTTP/1.1 的性能难以满足如今的高流量网站，于是又出现了 HTTP/2 和 HTTP/3。不过这两个新版本的协议还没有完全推广开。在可预见的将来，HTTP/1.1 还会继续存在下去。</p><p>HTTP 翻译成中文是 <strong>超文本传输协议</strong> ，是一个应用层的协议，通常基于 TCP/IP，能够在网络的任意两点之间传输文字、图片、音频、视频等数据。</p><p>HTTP 协议中的两个端点称为 <strong>请求方</strong> 和 <strong>应答方</strong> 。请求方通常就是 Web 浏览器，也叫 user agent，应答方是 Web 服务器，存储着网络上的大部分静态或动态的资源。</p><p>在浏览器和服务器之间还有一些 <strong>中间人</strong> 的角色，如 CDN、网关、代理等，它们也同样遵守 HTTP 协议，可以帮助用户更快速、更安全地获取资源。</p><p>HTTP 协议不是一个孤立的协议，需要下层很多其他协议的配合。最基本的是 TCP/IP，实现寻址、路由和可靠的数据传输，还有 DNS 协议实现对互联网上主机的定位查找。</p><p>对 HTTP 更准确的称呼是 <strong>HTTP over TCP/IP</strong> ，而另一个 <strong>HTTP over SSL/TLS</strong> 就是增加了安全功能的 HTTPS。</p><h2 id="软件介绍" tabindex="-1"><a class="header-anchor" href="#软件介绍"><span>软件介绍</span></a></h2><p>常言道实践出真知，又有俗语光说不练是假把式。要研究 HTTP 协议，最好有一个实际可操作、可验证的环境，通过实际的数据、现象来学习，肯定要比单纯的“动嘴皮子”效果要好的多。</p><p>现成的环境当然有，只要能用浏览器上网，就会有 HTTP 协议，就可以进行实验。但现实的网络环境又太复杂了，有很多无关的干扰因素，这些噪音会淹没真正有用的信息。</p><p>所以，我给你的建议是：搭建一个 <strong>最小化</strong> 的环境，在这个环境里仅有 HTTP 协议的两个端点：请求方和应答方，去除一切多余的环节，从而可以抓住重点，快速掌握 HTTP 的本质。</p><figure><img src="'+a+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>简单说一下这个「最小化」环境用到的应用软件：</p><ul><li><p>Wireshark</p><p>著名的网络抓包工具，能够截获在 TCP/IP 协议栈中传输的所有流量，并按协议类型、地址、端口等任意过滤，功能非常强大，是学习网络协议的必备工具。</p><p>它就像是网络世界里的一台「高速摄像机」，把只在一瞬间发生的网络传输过程如实地「拍摄」下来，事后再「慢速回放」，让我们能够静下心来仔细地分析那一瞬到底发生了什么。</p></li><li><p>Chrome/Firefox</p><p>Google 开发的浏览器，是目前的主流浏览器之一。它不仅上网方便，也是一个很好的调试器，对 HTTP/1.1、HTTPS、HTTP/2、QUIC 等的协议都支持得非常好，用 F12 打开「开发者工具」还可以非常详细地观测 HTTP 传输全过程的各种数据。</p><p>如果你更习惯使用 <strong>Firefox</strong>，那也没问题，其实它和 Chrome 功能上都差不太多，选择自己喜欢的就好。</p><p>与 Wireshark 不同，Chrome 和 Firefox 属于事后诸葛亮，不能观测 HTTP 传输的过程，只能看到结果。</p></li><li><p>Telnet</p><p>是一个经典的虚拟终端，基于 TCP 协议远程登录主机，我们可以使用它来模拟浏览器的行为，连接服务器后手动发送 HTTP 请求，把浏览器的干扰也彻底排除，能够从最原始的层面去研究 HTTP 协议。</p></li><li><p>OpenResty</p><p>你可能比较陌生，它是基于 Nginx 的一个强化包，里面除了 Nginx 还有一大堆有用的功能模块，不仅支持 HTTP/HTTPS，还特别集成了脚本语言 Lua 简化 Nginx 二次开发，方便快速地搭建动态网关，更能够当成应用容器来编写业务逻辑。</p><p>选择 OpenResty 而不直接用 Nginx 的原因是它相当于 Nginx 的超集，功能更丰富，安装部署更方便。我也会用 Lua 编写一些服务端脚本，实现简单的 Web 服务器响应逻辑，方便实验。</p></li></ul><h2 id="安装过程" tabindex="-1"><a class="header-anchor" href="#安装过程"><span>安装过程</span></a></h2><p>使用的是 win10 系统，如果不是可能需要使用虚拟机安装一个 win10 系统来进行测试。（如果你会其他的技术能替代下面的软件也可以）</p><p>首先使用到的一些测试脚本在该仓库可以下载到，先 clone 下来</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clone</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://github.com/chronolaw/http_study.git</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="'+A+'" alt="image-20210303183633464" tabindex="0" loading="lazy"><figcaption>image-20210303183633464</figcaption></figure><ul><li><p><a href="https://www.wireshark.org/download.html" target="_blank" rel="noopener noreferrer">Wireshark</a> v3.0.0</p><p>基本上就是下一步下一步就可以安装完成</p><p>这个最好使用相同的版本，防止与课程中讲解的不一致的问题，有专研精神的可以使用最新版本</p></li><li><p>Chrome v73：可以使用最新版本</p></li></ul><p>前两个自行下载安装包安装，可以使用新版本，安装较为简单。</p><h3 id="telnet" tabindex="-1"><a class="header-anchor" href="#telnet"><span>Telnet</span></a></h3><p>Telnet win10 自带，默认不启用，开启方式如下：</p><p>打开 Windows 的设置窗口，搜索「Telnet」，就会找到「启用或关闭 Windows 功能」，在这个窗口里找到「Telnet 客户端」，打上对钩就可以了，可以参考截图。</p><figure><img src="'+p+'" alt="image-20210303184026726" tabindex="0" loading="lazy"><figcaption>image-20210303184026726</figcaption></figure><h3 id="openresty" tabindex="-1"><a class="header-anchor" href="#openresty"><span>OpenResty</span></a></h3><p>版本：64 位 1.15.81，下载地址：<a href="http://openresty.org/cn/download.html" target="_blank" rel="noopener noreferrer">官网</a>，<a href="https://openresty.org/download/openresty-1.15.8.1-win64.zip" target="_blank" rel="noopener noreferrer">openresty-1.15.8.1.zip</a></p><p>解压到刚刚 clone 下来的仓库目录，如下图所示（途中下载的是 tar.gz 包，下错了，后来已经修正为 zip 包了）</p><figure><img src="'+l+'" alt="image-20210303184415482" tabindex="0" loading="lazy"><figcaption>image-20210303184415482</figcaption></figure><p>因为 www 目录里面的脚本路径写的是这个目录下的路径。</p><h3 id="修改本机-hosts-文件" tabindex="-1"><a class="header-anchor" href="#修改本机-hosts-文件"><span>修改本机 hosts 文件</span></a></h3><p>为了能够让浏览器能够使用 DNS 域名访问我们的实验环境，还要改一下本机的 hosts 文件，位置在 <code>C:\\WINDOWS\\system32\\drivers\\etc\\hosts</code></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># http 协议实验室域名</span></span>\n<span class="line"><span>127.0.0.1 www.chrono.com</span></span>\n<span class="line"><span>127.0.0.1 www.metroid.net</span></span>\n<span class="line"><span>127.0.0.1 origin.io</span></span>\n<span class="line"><span># ======================</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意修改 hosts 文件需要管理员权限，直接用记事本编辑是不行的，可以切换管理员身份，或者改用其他高级编辑器，比如 Notepad++，而且改之前最好做个备份。</p><p>到这里，我们的安装工作就完成了！之后你就可以用 Wireshark、Chrome、Telnet 在这个环境里随意折腾，弄坏了也不要紧，只要把目录删除，再来一遍操作就能复原。</p><h2 id="测试验证" tabindex="-1"><a class="header-anchor" href="#测试验证"><span>测试验证</span></a></h2><p>实验环境搭建完了，但还需要把它运行起来，做一个简单的测试验证，看是否运转正常。</p><p>首先我们要启动 Web 服务器，也就是 OpenResty。</p><p>在 http_study 的 www 目录下有四个批处理文件，分别是：</p><ul><li>start：启动 OpenResty 服务器；</li><li>stop：停止 OpenResty 服务器；</li><li>reload：重启 OpenResty 服务器；</li><li>list：列出已经启动的 OpenResty 服务器进程。</li></ul><p>使用鼠标双击 start 批处理文件，就会启动 OpenResty 服务器在后台运行，这个过程可能会有 Windows 防火墙的警告，选择「允许」即可。</p><p>运行后，鼠标双击 list 可以查看 OpenResty 是否已经正常启动，应该会有两个 nginx.exe 的后台进程，大概是下图的样子。</p><figure><img src="data:image/png;base64,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" alt="image-20210303190034087" tabindex="0" loading="lazy"><figcaption>image-20210303190034087</figcaption></figure><p>因为我们的实验环境运行在本机的 127.0.0.1 上，也就是 loopback 环回地址。所以，在 Wireshark 里要选择「Npcap loopback Adapter」，过滤器选择 <code>HTTP TCP port(80)</code> ，即只抓取 HTTP 相关的数据包。鼠标双击开始界面里的「Npcap loopback Adapter」 即可开始抓取本机上的网络数据。</p><p>关于 Npcap loopback Adapter 这个的说明，笔者还记得的是 Wireshark 自带的是没有这个接口的，在安装的时候不要选择自带的 Npcap，要自己去下载独立的软件包，安装之后才会有。</p><p>但是最新版本的 Wireshark 提供的 Adapter for loopback traffic capture 接口已经可以能捕获到本机回环的流量了</p><figure><img src="'+s+'" alt="image-20210303191636900" tabindex="0" loading="lazy"><figcaption>image-20210303191636900</figcaption></figure><p>选择接口后，在下图的过滤中只过滤 80 端口的流量</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>tcp.port == 80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>本机 80 端口一般不会被使用，这样过滤出来的才是我们想要的信息，否则将会看到类似刷屏的信息，看不过来的</p><p>关于这个过滤器的使用，前面说到在选择回环接口之前选择 <code>HTTP TCP port(80)</code> 这个操作是下面这个图，它相当于是一个快捷功能吧，上面我们直接填写的过滤条件，过滤结果是一样的。</p><figure><img src="'+r+'" alt="image-20210304101549294" tabindex="0" loading="lazy"><figcaption>image-20210304101549294</figcaption></figure><p>然后我们打开 Chrome，在地址栏输入 <a href="http://localhost/%EF%BC%8C%E8%AE%BF%E9%97%AE%E5%88%9A%E6%89%8D%E5%90%AF%E5%8A%A8%E7%9A%84" target="_blank" rel="noopener noreferrer">http://localhost/，访问刚才启动的</a> OpenResty 服务器，就会看到一个简单的欢迎界面，如下图所示。</p><figure><img src="'+o+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>然后查看 wireshark 界面，就看到了有几条数据出现了</p><figure><img src="'+d+'" alt="image-20210303191137031" tabindex="0" loading="lazy"><figcaption>image-20210303191137031</figcaption></figure><p>至于这些数据是什么，表示什么含义，我会在下一讲再详细介绍。</p><p>如果你能够在自己的电脑上走到这一步，就说明「最小化」的实验环境已经搭建成功了，不要忘了实验结束后运行批处理 stop 停止 OpenResty 服务器。</p><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结"><span>小结</span></a></h2><p>这次我们学习了如何在自己的电脑上搭建 HTTP 实验环境，在这里简单小结一下今天的内容。</p><ol><li>现实的网络环境太复杂，有很多干扰因素，搭建「最小化」的环境可以快速抓住重点，掌握 HTTP 的本质；</li><li>我们选择 Wireshark 作为抓包工具，捕获在 TCP/IP 协议栈中传输的所有流量；</li><li>我们选择 Chrome 或 Firefox 浏览器作为 HTTP 协议中的 user agent；</li><li>我们选择 OpenResty 作为 Web 服务器，它是一个 Nginx 的强化包，功能非常丰富；</li><li>Telnet 是一个命令行工具，可用来登录主机模拟浏览器操作；</li><li>在 GitHub 上可以下载到本专栏的专用项目源码，只要把 OpenResty 解压到里面即可完成实验环境的搭建。</li></ol><h2 id="课下作业" tabindex="-1"><a class="header-anchor" href="#课下作业"><span>课下作业</span></a></h2><ol><li><p>按照今天所学的，在你自己的电脑上搭建出这个 HTTP 实验环境并测试验证。</p></li><li><p>由于篇幅所限，我无法详细介绍 Wireshark，你有时间可以再上网搜索 Wireshark 相关的资料，了解更多的用法。</p></li></ol><h2 id="课外小贴士" tabindex="-1"><a class="header-anchor" href="#课外小贴士"><span>课外小贴士</span></a></h2><ul><li><p>如果你会编程，还可以选择一种自己擅长的语言（如 Python），调用专用库，去访问 OpenResty 服务器</p></li><li><p>在 Linux 上可以直接从源码编译 OpenResty，用 curl 发送测试命令，用 tcpdump 抓包</p></li><li><p>除了经典的 Wireshark 抓包工具外，还有一个专门抓 HTTP 包的工具 Fiddler</p></li><li><p>如果无法正常启动 OpenResty，最大的可能就是端口 80 或 443 被占用了（比如安装了 WMWare workstation）</p><p>先看 <code>www/logs</code> 里的错误日志，然后在命令行中用</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>netstat -aon | findstr :443</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>找到占用的进程或服务，手动停止就可以了</p></li><li><p>有时候可能 stop 批处理脚本无法正确停止 OpenResty，可以使用「任务管理器」查找 nginx.exe 进程，强制关闭</p></li><li><p>话说 OpenResty 和同级目录下的 www 是如何关联上的，笔者还不清楚</p><p>但是 www/conf/http/servers 下的 nginx xx.conf 配置文件是使用了的</p></li></ul>',68)]))}]]),h=JSON.parse('{"path":"/http-protocol/02/07.html","title":"07 | 自己动手，搭建 HTTP 实验环境","lang":"zh-CN","frontmatter":{"description":"07 | 自己动手，搭建 HTTP 实验环境 这一讲是「破冰篇」的最后一讲，我会先简单地回顾一下之前的内容，然后在 Windows 系统上实际操作，用几个应用软件搭建出一个「最小化」的 HTTP 实验环境，方便后续的基础篇、进阶篇、安全篇的学习。 破冰篇回顾 HTTP 协议诞生于 30 年前，设计之初的目的是用来传输纯文本数据。但由于形式灵活，搭配 U...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/blog_postgraduate/http-protocol/02/07.html"}],["meta",{"property":"og:site_name","content":"博客"}],["meta",{"property":"og:title","content":"07 | 自己动手，搭建 HTTP 实验环境"}],["meta",{"property":"og:description","content":"07 | 自己动手，搭建 HTTP 实验环境 这一讲是「破冰篇」的最后一讲，我会先简单地回顾一下之前的内容，然后在 Windows 系统上实际操作，用几个应用软件搭建出一个「最小化」的 HTTP 实验环境，方便后续的基础篇、进阶篇、安全篇的学习。 破冰篇回顾 HTTP 协议诞生于 30 年前，设计之初的目的是用来传输纯文本数据。但由于形式灵活，搭配 U..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-12-19T04:03:18.000Z"}],["meta",{"property":"article:modified_time","content":"2024-12-19T04:03:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"07 | 自己动手，搭建 HTTP 实验环境\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-12-19T04:03:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Leo\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"破冰篇回顾","slug":"破冰篇回顾","link":"#破冰篇回顾","children":[]},{"level":2,"title":"软件介绍","slug":"软件介绍","link":"#软件介绍","children":[]},{"level":2,"title":"安装过程","slug":"安装过程","link":"#安装过程","children":[{"level":3,"title":"Telnet","slug":"telnet","link":"#telnet","children":[]},{"level":3,"title":"OpenResty","slug":"openresty","link":"#openresty","children":[]},{"level":3,"title":"修改本机 hosts 文件","slug":"修改本机-hosts-文件","link":"#修改本机-hosts-文件","children":[]}]},{"level":2,"title":"测试验证","slug":"测试验证","link":"#测试验证","children":[]},{"level":2,"title":"小结","slug":"小结","link":"#小结","children":[]},{"level":2,"title":"课下作业","slug":"课下作业","link":"#课下作业","children":[]},{"level":2,"title":"课外小贴士","slug":"课外小贴士","link":"#课外小贴士","children":[]}],"git":{"createdTime":1734580998000,"updatedTime":1734580998000,"contributors":[{"name":"liao_rh","username":"liao_rh","email":"993929808@qq.com","commits":1,"url":"https://github.com/liao_rh"}]},"readingTime":{"minutes":9.98,"words":2995},"filePathRelative":"http-protocol/02/07.md","localizedDate":"2024年12月19日","excerpt":"\\n<p>这一讲是「破冰篇」的最后一讲，我会先简单地回顾一下之前的内容，然后在 Windows 系统上实际操作，用几个应用软件搭建出一个「最小化」的 HTTP 实验环境，方便后续的基础篇、进阶篇、安全篇的学习。</p>\\n<h2>破冰篇回顾</h2>\\n<p>HTTP 协议诞生于 30 年前，设计之初的目的是用来传输纯文本数据。但由于形式灵活，搭配 URI、HTML 等技术能够把互联网上的资源都联系起来，构成一个复杂的超文本系统，让人们自由地获取信息，所以得到了迅猛发展。</p>\\n<p>HTTP 有多个版本，目前应用的最广泛的是 HTTP/1.1，它几乎可以说是整个互联网的基石。但 HTTP/1.1 的性能难以满足如今的高流量网站，于是又出现了 HTTP/2 和 HTTP/3。不过这两个新版本的协议还没有完全推广开。在可预见的将来，HTTP/1.1 还会继续存在下去。</p>","autoDesc":true}')}}]);